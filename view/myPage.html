<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 리셋 css -->
    <!-- <link rel="stylesheet" href="../css/reset.css"/> -->
    <!-- 헤더 css -->
    <!-- <link rel="stylesheet" href="../css/header.css"/> -->
    <!-- <link rel="stylesheet" href="../css/myPage.css"/> -->
    <!-- <link rel="stylesheet" href="../css/footer.css"/> -->
    <!-- jquery -->
    <script  src="http://code.jquery.com/jquery-latest.min.js"></script>
    <title>프로필 수정</title>
    <style>
        @font-face {
            font-family: 'DungGeunMo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            
        }
        body{
            font-size: 1.5em;
            margin: 0;
            padding: 0;
            background-color: black;
            color: white;
            font-family: 'DungGeunMo';
        }
        .filebox label {
            display: inline-block;
            padding: .5em .75em;
            font-size: inherit;
            line-height: normal;
            vertical-align: middle;
            background-color: blue;
            cursor: pointer;
            /* border: 1px solid #ebebeb; */
            border-bottom-color: #e2e2e2;
            /* border-radius: .25em; */
        }
        .filebox label:hover{
            background-color: white;
            color: blue;
        }

        .filebox input[type="file"] {  
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip:rect(0,0,0,0);
            border: 0;
        }
        .content{
            position: relative;
            top: 1.5vw;
        }
        .main{
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            background-color: blue;
            width:20vh;
            height:50vh;
            max-width: 1000px;
            max-height: 600px;
            word-break: break-all;
            min-width: 300px;
            min-height: 300px;
            position: absolute;
            /* 무족건 무슨일이 있어도 정중앙 */
            top: 50%;
            left:50%;
            transform: translate(-50%,-50%);
        }
        .profile{
            text-align: center;
            position: relative;
            bottom: 13vh;
            font-size: 2.6vh;
        }
        .profilePicture{
            display: flex;
            align-items: center;
            position: relative;
            bottom: 5vh;
            font-size: 2vh;
        }
        .profilePictureText{
            margin-right: 2vh;
        }
        .filebox{
            display: flex;
            align-items: center;
        }
        .filebox > label{
            margin-left: 1vh;
        }
        .profileName{
            font-size: 2vh;
        }
        .profileName > input{
            width: 13vw;
            min-width: 150px;
            padding: 0.5em;
            font-size: 1vh;
        }
        .profileBtn{
            position: relative;
            top: 5vh;
            text-align: center;
        }
        .profileBtn > button{
            padding: 1vw;
            margin-right: 2vh;
            font-family: 'DungGeunMo';
            font-size: 1.5vh;
            color: white;
            border: 0;
            background-color: blue;
        }
        .profileBtn > button:hover{
            color: blue;
            background-color: white;
        }
        img{
            width: 10vh;
            height: 10vh;
            border: 3px solid white;
        }
    </style>
</head>
<body>
    <div class="main">
        <div class="content">
            <div class="profile"><%=data.nickName%> 님의 마이 페이지</div>
            <div class="profilePicture">
                <span class="profilePictureText">프로필 사진 : </span> 
                <span class="filebox">
                    <img id="preview-image" src="<%= data.profilePicture %>" width="100" height="100" >
                    <input style="display: inline-block;" type="file" id="input-image">
                    <input type="file" accept="image/*" id="input-image" name="profilePicture" value="" >
                    <label for="input-image">사진변경</label>
                    <label class="preview-de">삭제</label> 
                </span>
            </div>
            <div class="profileName">닉네임 수정 : <input id="nickname" value="<%= data.nickName %>" name="nickname"></div>
            <div class="profileBtn">
                <button id="upload" type="button">적 용</button>
                <button id="logout" type="button">돌 아 가 기</button>
            </div>
        </div>
    </div>
    
</body>
<script>
    if(window.innerWidth <= 850){
        document.querySelector(".main").style.width = "100%"
        document.querySelector(".main").style.maxWidth = "100%"
        document.querySelector(".main").style.height = "100%"
        document.querySelector(".main").style.maxHeight = "100vh"
        document.querySelector(".main").style.border = "0"
        // document.querySelectorAll(".userUI")[1].style.fontSize = "3vw"
    }
    else{
        document.querySelector(".main").style.width = "50vw"
        document.querySelector(".main").style.maxWidth = "1000px"
        document.querySelector(".main").style.height = "50vw"
        document.querySelector(".main").style.maxHeight = "600px"
        document.querySelector(".main").style.border = "3px solid"
        // document.querySelectorAll(".userUI")[1].style.fontSize = "1em"
    }
    const previewImage = document.getElementById("preview-image");
    let count = false;
    let nick = nickname.value;
    // 
        function readImage(input) {
        // 인풋 태그에 파일이 있는 경우
        if(input.files && input.files[0] && count == false) {
            count = true;
            // 이미지 파일인지 검사 (생략)
            // FileReader 인스턴스 생성
            const reader = new FileReader()
            // 이미지가 로드가 된 경우
            reader.onload = e => {
                previewImage.src = e.target.result
            }
            // reader가 이미지 읽도록 하기
            reader.readAsDataURL(input.files[0])
        }
    }
    // input file에 change 이벤트 부여
    const inputImage = document.getElementById("input-image")
    inputImage.addEventListener("change", e => {
        readImage(e.target)
    })

    const previewde = document.querySelector(".preview-de");
    previewde.addEventListener("click",function(){
        if(count == true){
            previewImage.src = "https://static.nid.naver.com/images/web/user/default.png?type=s160";
            count = false;
        }
    })

    upload.onclick = function(e){
        e.preventDefault();
        imgUpload();
    };
    function imgUpload(){
        let formdata = new FormData();
        var file = document.querySelector('#input-image').files[0];  
        formdata.append('file', file);	
        formdata.append('nickname', nick);
        formdata.append('chageNickname', nickname.value);
        $.ajax({
            url : '/myPage',
            type : 'post',
            processData: false,
            contentType: false,
            data : formdata,
            success : function(data){
                alert('적용되었습니다');
                location.reload();
            }
        })
    }
    // 적용 버튼 이미지 업로드 
    upload.onclick = function(e){
        e.preventDefault();
        imgUpload();
    };
    
    function imgUpload(){
        let formdata = new FormData();
        var file = document.querySelector('#input-image').files[0];  
        formdata.append('file', file);	
        formdata.append('nickname', nick);
        formdata.append('chageNickname', nickname.value);
        $.ajax({
            url : '/myPage',
            type : 'post',
            processData: false,
            contentType: false,
            data : formdata,
            success : function(data){
                alert('적용되었습니다');
                location.reload();
            }
        })
    }
    // 로그아웃 버튼 쿠키 로그아웃 
    logout.onclick = function(e){
        e.preventDefault();
        location.href = "/index"
    };
    
</script>
</html>

